<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="Definitions_1" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="1.9.0">
  <bpmn:process id="request_for_price" name="产品询价" isExecutable="true" camunda:versionTag="1.0">
    <bpmn:startEvent id="submit_order" name="提交销售订单" camunda:formKey="order_process_start">
      <bpmn:outgoing>SequenceFlow_16sjhve</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:sequenceFlow id="SequenceFlow_16sjhve" sourceRef="submit_order" targetRef="product_process" />
    <bpmn:endEvent id="EndEvent_1nyr5jo" name="处理完成">
      <bpmn:incoming>SequenceFlow_10kyifc</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:serviceTask id="product_process" name="自动分类" camunda:delegateExpression="${salesOrderProcessService}">
      <bpmn:incoming>SequenceFlow_16sjhve</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_1dgzce7</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="SequenceFlow_1dgzce7" sourceRef="product_process" targetRef="manual_allocation" />
    <bpmn:subProcess id="price_inquiry_sub_flow" name="工厂核算与采购询价">
      <bpmn:incoming>SequenceFlow_0ior3oc</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_10kyifc</bpmn:outgoing>
      <bpmn:multiInstanceLoopCharacteristics camunda:collection="${salesOrderRepository.findSalesOrderAssignees(businessKey)}" camunda:elementVariable="participant" />
      <bpmn:startEvent id="StartEvent_1lywb22" name="任务处理">
        <bpmn:outgoing>SequenceFlow_1xblwbq</bpmn:outgoing>
      </bpmn:startEvent>
      <bpmn:sequenceFlow id="SequenceFlow_1xblwbq" sourceRef="StartEvent_1lywb22" targetRef="price_inquiry" />
      <bpmn:sequenceFlow id="SequenceFlow_176podh" sourceRef="price_inquiry" targetRef="assign_price_auditor" />
      <bpmn:endEvent id="EndEvent_1mv9aoo" name="处理完成">
        <bpmn:incoming>audit_result_pass</bpmn:incoming>
      </bpmn:endEvent>
      <bpmn:sequenceFlow id="SequenceFlow_02yurql" sourceRef="price_audit" targetRef="check_audit_result" />
      <bpmn:sequenceFlow id="SequenceFlow_0sl1yry" sourceRef="assign_price_auditor" targetRef="price_audit" />
      <bpmn:userTask id="price_inquiry" name="询价" camunda:assignee="${participant}">
        <bpmn:incoming>SequenceFlow_1xblwbq</bpmn:incoming>
        <bpmn:incoming>audit_result_fail</bpmn:incoming>
        <bpmn:outgoing>SequenceFlow_176podh</bpmn:outgoing>
      </bpmn:userTask>
      <bpmn:userTask id="price_audit" name="报价审核" camunda:assignee="${priceAuditor}">
        <bpmn:incoming>SequenceFlow_0sl1yry</bpmn:incoming>
        <bpmn:outgoing>SequenceFlow_02yurql</bpmn:outgoing>
      </bpmn:userTask>
      <bpmn:serviceTask id="assign_price_auditor" name="分配审核人" camunda:delegateExpression="${salesOrderProcessService}">
        <bpmn:incoming>SequenceFlow_176podh</bpmn:incoming>
        <bpmn:outgoing>SequenceFlow_0sl1yry</bpmn:outgoing>
      </bpmn:serviceTask>
      <bpmn:exclusiveGateway id="ExclusiveGateway_1jsk5w2">
        <bpmn:incoming>SequenceFlow_0vro4p2</bpmn:incoming>
        <bpmn:outgoing>audit_result_pass</bpmn:outgoing>
        <bpmn:outgoing>audit_result_fail</bpmn:outgoing>
      </bpmn:exclusiveGateway>
      <bpmn:sequenceFlow id="audit_result_pass" name="通过" sourceRef="ExclusiveGateway_1jsk5w2" targetRef="EndEvent_1mv9aoo">
        <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${isPass}</bpmn:conditionExpression>
      </bpmn:sequenceFlow>
      <bpmn:sequenceFlow id="audit_result_fail" name="不通过" sourceRef="ExclusiveGateway_1jsk5w2" targetRef="price_inquiry">
        <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${!isPass}</bpmn:conditionExpression>
      </bpmn:sequenceFlow>
      <bpmn:sequenceFlow id="SequenceFlow_0vro4p2" sourceRef="check_audit_result" targetRef="ExclusiveGateway_1jsk5w2" />
      <bpmn:serviceTask id="check_audit_result" name="审核结果" camunda:delegateExpression="${salesOrderProcessService}">
        <bpmn:incoming>SequenceFlow_02yurql</bpmn:incoming>
        <bpmn:outgoing>SequenceFlow_0vro4p2</bpmn:outgoing>
      </bpmn:serviceTask>
    </bpmn:subProcess>
    <bpmn:userTask id="manual_allocation" name="分配任务" camunda:candidateGroups="RFP_TASK_ADMIN">
      <bpmn:incoming>SequenceFlow_1dgzce7</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_0ior3oc</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:sequenceFlow id="SequenceFlow_0ior3oc" sourceRef="manual_allocation" targetRef="price_inquiry_sub_flow" />
    <bpmn:sequenceFlow id="SequenceFlow_10kyifc" sourceRef="price_inquiry_sub_flow" targetRef="EndEvent_1nyr5jo" />
  </bpmn:process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="request_for_price">
      <bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="submit_order">
        <dc:Bounds x="78" y="102" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="64" y="138" width="66" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_16sjhve_di" bpmnElement="SequenceFlow_16sjhve">
        <di:waypoint xsi:type="dc:Point" x="114" y="120" />
        <di:waypoint xsi:type="dc:Point" x="177" y="120" />
        <di:waypoint xsi:type="dc:Point" x="177" y="120" />
        <di:waypoint xsi:type="dc:Point" x="202" y="120" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="359" y="114" width="90" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="EndEvent_1nyr5jo_di" bpmnElement="EndEvent_1nyr5jo">
        <dc:Bounds x="1652" y="102" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1648" y="142" width="44" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ServiceTask_1med2zb_di" bpmnElement="product_process">
        <dc:Bounds x="202" y="80" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_1dgzce7_di" bpmnElement="SequenceFlow_1dgzce7">
        <di:waypoint xsi:type="dc:Point" x="302" y="120" />
        <di:waypoint xsi:type="dc:Point" x="379" y="120" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="295.5" y="99" width="90" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="SubProcess_0blv5ja_di" bpmnElement="price_inquiry_sub_flow" isExpanded="true">
        <dc:Bounds x="543" y="-26" width="1028" height="291" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="StartEvent_1lywb22_di" bpmnElement="StartEvent_1lywb22">
        <dc:Bounds x="591.9251497005988" y="56" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="588" y="96.30139720558884" width="44" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="UserTask_0kuwz3h_di" bpmnElement="manual_allocation">
        <dc:Bounds x="379" y="80" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_0ior3oc_di" bpmnElement="SequenceFlow_0ior3oc">
        <di:waypoint xsi:type="dc:Point" x="479" y="120" />
        <di:waypoint xsi:type="dc:Point" x="511" y="120" />
        <di:waypoint xsi:type="dc:Point" x="511" y="120" />
        <di:waypoint xsi:type="dc:Point" x="543" y="120" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="526" y="114" width="0" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_1xblwbq_di" bpmnElement="SequenceFlow_1xblwbq">
        <di:waypoint xsi:type="dc:Point" x="628" y="74" />
        <di:waypoint xsi:type="dc:Point" x="692" y="73" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="660" y="52.5" width="0" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_176podh_di" bpmnElement="SequenceFlow_176podh">
        <di:waypoint xsi:type="dc:Point" x="792" y="73" />
        <di:waypoint xsi:type="dc:Point" x="861" y="74" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="826.5" y="52.5" width="0" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="EndEvent_1mv9aoo_di" bpmnElement="EndEvent_1mv9aoo">
        <dc:Bounds x="1489.3882235528943" y="56" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1485" y="96" width="44" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_02yurql_di" bpmnElement="SequenceFlow_02yurql">
        <di:waypoint xsi:type="dc:Point" x="1130" y="74" />
        <di:waypoint xsi:type="dc:Point" x="1199" y="74" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1164.5" y="53" width="0" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0sl1yry_di" bpmnElement="SequenceFlow_0sl1yry">
        <di:waypoint xsi:type="dc:Point" x="961" y="74" />
        <di:waypoint xsi:type="dc:Point" x="1030" y="74" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="995.5" y="53" width="0" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="UserTask_10guq1s_di" bpmnElement="price_inquiry">
        <dc:Bounds x="691.9251497005988" y="34" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="UserTask_0kfaa33_di" bpmnElement="price_audit">
        <dc:Bounds x="1029.925149700599" y="34" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ServiceTask_199cbya_di" bpmnElement="assign_price_auditor">
        <dc:Bounds x="860.9251497005988" y="34" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_10kyifc_di" bpmnElement="SequenceFlow_10kyifc">
        <di:waypoint xsi:type="dc:Point" x="1571" y="120" />
        <di:waypoint xsi:type="dc:Point" x="1611" y="120" />
        <di:waypoint xsi:type="dc:Point" x="1611" y="120" />
        <di:waypoint xsi:type="dc:Point" x="1652" y="120" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1626" y="114" width="0" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ExclusiveGateway_1jsk5w2_di" bpmnElement="ExclusiveGateway_1jsk5w2" isMarkerVisible="true">
        <dc:Bounds x="1367.925149700599" y="49" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1392.925149700599" y="103" width="0" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_0tmwkxe_di" bpmnElement="audit_result_pass">
        <di:waypoint xsi:type="dc:Point" x="1418" y="74" />
        <di:waypoint xsi:type="dc:Point" x="1489" y="74" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1443" y="53" width="22" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_1fpik3y_di" bpmnElement="audit_result_fail">
        <di:waypoint xsi:type="dc:Point" x="1393" y="99" />
        <di:waypoint xsi:type="dc:Point" x="1393" y="199" />
        <di:waypoint xsi:type="dc:Point" x="742" y="199" />
        <di:waypoint xsi:type="dc:Point" x="742" y="114" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1052" y="178" width="33" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0vro4p2_di" bpmnElement="SequenceFlow_0vro4p2">
        <di:waypoint xsi:type="dc:Point" x="1299" y="74" />
        <di:waypoint xsi:type="dc:Point" x="1368" y="74" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1333.5" y="53" width="0" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ServiceTask_13z5hfn_di" bpmnElement="check_audit_result">
        <dc:Bounds x="1198.925149700599" y="34" width="100" height="80" />
      </bpmndi:BPMNShape>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
